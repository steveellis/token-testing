<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Token Tester</title>
</head>

<body>
  <h1>Token tester</h1>
  <p><a href="javascript:refresh()">Refresh your token</a></p>
  <p><a href="javascript:logout()">Logout</a></p>
  <p><a href="javascript:logoutAll()">Logout all</a></p>
  <p><a href="javascript:inventorySearch()">Inventory search</a></p>
  <script>
    var host = "https://core-platform-okapi.ci.folio.org";
    //var loginEndpoint = "bl-users";
    var loginEndpoint = "bl-users";
    // For CP rancher
    var credentials = { "username": "diku_admin", "password": "admin" };
    // For folio-run-local
    //var credentials = { "username": "testing_admin", "password": "admin" };
    var headers = {
          'Content-type': 'application/json; charset=UTF-8',
          'X-Okapi-Tenant': 'diku'
        };
    function inventorySearch() {
      console.log("search inventory")
      fetch(`${host}/search/instances?highlightMatch=true&limit=100&query=%28keyword%20all%20%22%2A%22%20or%20isbn%3D%22%2A%22%29%20sortby%20title`, {
        method: 'GET',
        credentials: 'include',
        mode: 'cors',
        headers: headers
      })
        .then(res => res.json())
        .then(console.log)
    }
    function logout() {
      console.log("logging out")
      fetch(`${host}/authn/logout`, {
        method: 'POST',
        credentials: 'include',
        mode: 'cors',
        body: null,
        headers: headers
      })
        .then(res => res.json())
        .then(console.log)
    }
    function logoutAll() {
      console.log("logout all")
      fetch(`${host}/authn/logout-all`, {
        method: 'POST',
        credentials: 'include',
        mode: 'cors',
        body: null,
        headers: headers
      })
        .then(res => res.json())
        .then(console.log)
    }
    function refresh() {
      console.log("refreshing token")
      fetch(`${host}/authn/refresh`, {
        method: 'POST',
        credentials: 'include',
        mode: 'cors',
        body: null,
        headers: headers
      })
        .then(res => res.json())
        .then(console.log)
    }
    console.log("Logging in and setting tokens");
    fetch(`${host}/${loginEndpoint}/login-with-expiry`, {
      method: 'POST',
      // Absolutely have to have this specified here or the second request above won't work!
      // https://stackoverflow.com/a/51726055
      credentials: 'include',
      mode: 'cors',
      body: JSON.stringify(credentials),
      headers: headers
    })
      .then(res => res.json())
      .then(console.log)
  </script>
</body>

</html>